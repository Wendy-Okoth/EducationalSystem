{% extends "base_student.html" %}
{% block title %}Academic Calendar{% endblock %}
{% block page_title %}Academic Calendar{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Calendar Header -->
    <section class="mb-8">
        <div class="bg-white rounded-2xl shadow-lg p-6 border border-slate-100">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 class="text-3xl font-black text-kas-dark-green mb-2 flex items-center">
                        <i class="fas fa-calendar-alt mr-3 text-kas-light-brown"></i>
                        Academic Calendar
                    </h1>
                    <p class="text-slate-600">Track exams, assignments, and important school events</p>
                </div>
                <div class="flex gap-2">
                    <button id="prev-month" class="px-4 py-2 rounded-xl border border-slate-300 hover:bg-slate-50 transition">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="today-btn" class="px-6 py-2 rounded-xl bg-kas-dark-green text-white hover:bg-kas-light-brown transition font-bold">
                        Today
                    </button>
                    <button id="next-month" class="px-4 py-2 rounded-xl border border-slate-300 hover:bg-slate-50 transition">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Calendar Container -->
    <section class="mb-8">
        <div class="bg-white rounded-2xl shadow-lg p-6 border border-slate-100">
            <div id="calendar" class="min-h-[600px]"></div>
        </div>
    </section>

    <!-- Upcoming Events -->
    <section>
        <div class="bg-white rounded-2xl shadow-lg p-6 border border-slate-100">
            <h2 class="text-2xl font-bold text-kas-dark-green mb-6 flex items-center">
                <i class="fas fa-bell mr-3 text-kas-light-brown"></i>
                Upcoming Events This Week
            </h2>
            
            <div id="upcoming-events" class="space-y-3">
                <!-- Events will be loaded dynamically -->
                <div class="text-center py-8 text-slate-500">
                    <i class="fas fa-calendar-day text-3xl mb-3 opacity-50"></i>
                    <p>Loading upcoming events...</p>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Calendar Custom Styling */
    .fc .fc-toolbar-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #2E5B27;
    }
    
    .fc .fc-button-primary {
        background-color: #2E5B27 !important;
        border-color: #2E5B27 !important;
    }
    
    .fc .fc-button-primary:hover {
        background-color: #D4A76A !important;
        border-color: #D4A76A !important;
        color: #2E5B27 !important;
    }
    
    .fc .fc-button-primary:disabled {
        background-color: #94a3b8 !important;
        border-color: #94a3b8 !important;
    }
    
    .fc-event {
        background-color: #D4A76A !important;
        border-color: #D4A76A !important;
        color: #2E5B27 !important;
        font-weight: 600;
        padding: 2px 4px;
    }
    
    .fc-day-today {
        background-color: #f8fafc !important;
    }
    
    .fc-daygrid-dot-event:hover {
        background-color: #f8fafc;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Load FullCalendar CSS and JS dynamically
        const calendarEl = document.getElementById('calendar');
        
        // Initialize FullCalendar
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            events: '/student/api/calendar_events',
            eventClick: function(info) {
                alert('Event: ' + info.event.title + '\nDate: ' + info.event.start.toLocaleDateString());
            },
            dateClick: function(info) {
                alert('Clicked on: ' + info.dateStr);
            }
        });
        
        calendar.render();
        
        // Navigation buttons
        document.getElementById('prev-month').addEventListener('click', function() {
            calendar.prev();
        });
        
        document.getElementById('next-month').addEventListener('click', function() {
            calendar.next();
        });
        
        document.getElementById('today-btn').addEventListener('click', function() {
            calendar.today();
        });
        
        // Load upcoming events
        fetch('/student/api/upcoming_events')
            .then(response => response.json())
            .then(events => {
                const upcomingEventsDiv = document.getElementById('upcoming-events');
                if (events.length === 0) {
                    upcomingEventsDiv.innerHTML = `
                        <div class="text-center py-8 text-slate-500">
                            <i class="fas fa-calendar-check text-3xl mb-3 opacity-50"></i>
                            <p>No upcoming events this week</p>
                        </div>`;
                    return;
                }
                
                upcomingEventsDiv.innerHTML = '';
                events.forEach(event => {
                    const eventDate = new Date(event.date);
                    const eventItem = document.createElement('div');
                    eventItem.className = 'p-4 bg-slate-50 rounded-xl border border-slate-200 hover:border-kas-light-brown transition-colors';
                    eventItem.innerHTML = `
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-kas-light-brown/10 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-${event.icon || 'calendar-alt'} text-kas-light-brown"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-kas-dark-green mb-1">${event.title}</h3>
                                <p class="text-sm text-slate-600 mb-2">${event.description || ''}</p>
                                <div class="flex items-center text-sm text-slate-500">
                                    <i class="fas fa-clock mr-2"></i>
                                    <span>${eventDate.toLocaleDateString()} â€¢ ${event.time || 'All day'}</span>
                                </div>
                            </div>
                            <span class="px-3 py-1 text-xs font-bold rounded-full ${event.type === 'exam' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'}">
                                ${event.type.toUpperCase()}
                            </span>
                        </div>
                    `;
                    upcomingEventsDiv.appendChild(eventItem);
                });
            })
            .catch(error => {
                console.error('Error loading events:', error);
                document.getElementById('upcoming-events').innerHTML = `
                    <div class="text-center py-8 text-red-500">
                        <i class="fas fa-exclamation-triangle text-3xl mb-3"></i>
                        <p>Error loading events</p>
                    </div>`;
            });
    });
</script>

<!-- Load FullCalendar Library -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
{% endblock %}




